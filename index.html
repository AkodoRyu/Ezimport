<!DOCTYPE html>
<html lang=en>
<head>
	<meta charset=UTF-8>
	<meta name=viewport content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0">

	<title>TweakIT</title>
	
	<!-- The framework -->
	<link rel=stylesheet href=css/inuit.css>
	<!-- Plugins -->
	<link rel=stylesheet href=css/grid.inuit.css>

	<link rel="stylesheet/less" type="text/css" href="css/styles.less">
	<script src="js/less.js" type="text/javascript"></script>

	<!--[if lt IE 9]>
	<script src="js/html5.js"></script>
	<![endif]-->	

	<!--[if IE 6]>
    <link rel=stylesheet href="css/ie6.inuit.css">
	<![endif]-->
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-27679031-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
		
</head>

<body>

	<a href="https://github.com/TweakIT/Ezimport"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
	
	<header class="wrapper header">

		<div class="grids">
		
			<div class="grid-16 grid">
				
				<h1 class="title"><span class="gold">Ez</span><span class="blue">import</span></h1>
				
				<h2>Ezimport is a simple Magento module that provides developers and shop owners with a platform which makes importing products from a lot of different XML files easier.</h2>
				
				<p><a href="https://github.com/TweakIT/Ezimport/zipball/master" class=button>Download .zip</a> <a href="https://github.com/TweakIT/Ezimport/tarball/master" class=button>Download .tar</a></p>
				
				<nav role=navigation>
					<ul class="nav">
						<li><a href=# title=""><span>Overview</span></a></li>
						<li><a href=# title=""><span>Usage</span></a></li>
						<li><a href=# title=""><span>Under the hood</span></a></li>
						<li><a href=# title=""><span>Writing tests</span></a></li>						
						<li><a href=# title=""><span>Technical docs</span></a></li>
						<li><a href=# title=""><span>About</span></a></li>
					</ul>
				</nav>
			
			</div>
			
		</div>
		
	</header>
			
	<article class="wrapper">

		<div class="grids">
		
			<div class="grid-16 grid">	

				<p class="message warning">This is an alpha release. Use at your own risk.</p>

				<h1>Overview</h1>
				
				<p>Some retailers may have to deal with lots of wholesalers that all have their own XML markup. Ezimport lets you easily map the XML fields to your own attributes.</p>
				
				<p>You can also define custom behaviour for the conversion. For instance, a product in an XML file may have the following field:</p>
				
				<p><pre>&lt;main_image>http://example.com/11dk2.jpg&lt;/main_image></pre></p>
				
				<p>Ezimport provides you with a platform that lets you define exactly what&#39;s going to happen with this XML field when you import products from this XML. In fact, Ezimport already provides you with an attribute class that downloads the image to the server and tells the Magento product to use that image as its base image and thumbnail. This attribute is called &quot;Base image&quot;.</p>
			
			</div>
			
			<div class="grid-5 grid">
				<h2>Import your file</h2>
			</div>
			
			<div class="grid-6 grid">
				<h2>Map XML fields</h2>
			</div>
			
			<div class="grid-5 grid">
				<h2>Import your products</h2>
			</div>
				
			<div class="grid-16 grid">
				
				<h1>Installation</h1>
				
				<p>Ezimport is currently not available as a Magento Connect PEAR channel community extension. The files in the &quot;src&quot; folder have to be manually copied to the Magento folder. After this, it&#39;s usually a good idea to renew the cache.</p>
				
				<h1>Usage</h1>
				
				<h2>Step 1 - importing a XML file</h2>
				
				<p>Click the Ezimport menu button, find the &quot;add new XML&quot; button in the top right corner and add a XML file by giving the URL, uploading a file or directly copy/pasting the XML file contents on the webpage.</p>
				
				<h2>Step 2 - writing attribute classes</h2>
				
				<p>Create a new .php file in the /app/code/local/Tweakit/Ezimport/Helper/Attributes/ folder. Certain naming conventions must be followed: If you name your attribute &quot;color&quot; the file name must be &quot;color.php&quot; and the classname must be &quot;Tweakit_Ezimport_Helper_Attributes_Color&quot;.</p>
				
				<p>The class must implement the &quot;Tweakit_Ezimport_Helper_IAttribute&quot; interface and have the following public methods:</p>
				
				<ul>
					<li><pre>getName()</pre></li>
					<li><pre>getIdentifier()</pre></li>
					<li><pre>getPreview($data)</pre></li>
					<li><pre>getName(Mage_Catalog_Model_Product $product, $data)</pre></li>
				</ul>
					
				<p>The Baseimage attribute (Baseimage.php), for instance, looks something like this:</p>
				
				<pre>
class Tweakit_Ezimport_Helper_Attributes_Baseimage implements Tweakit_Ezimport_Helper_IAttribute {

	public function getName() {
		return 'Base Image';	
	}
</pre>	
	<p>getName should return the name of the attribute. The name will be the label showed in the mapper, 
	so you know what to drag to this attribute.</p>
<pre>
	public function getIdentifier() {
		return 'baseimage';	
	}
</pre>	
	<p>Should return an unique identifier of the attribute. The identifier of this attribute will 
	be associated with the XML field and this pair is saved to the database.</p>
<pre>	
	public function getPreview($content) {
		return '&lt;image width="200px" src="'.$content.'" alt="'.$content.' (image not available)" />';
	}
</pre>	
	<p> This will return an HTML piece containing a preview of the value of the attribute. 
	This is used inside a table of the &quot;view products&quot; screen, before importing the products.
	In this case the image will be displayed instead of the URL. If the image isnt available, an 
	alternate text will be shown. If we wanted the URL to be shown, we would simply do 
	return &quot;$content&quot; without actually doing anything with the value.</p>
<pre>
	public function setData(Mage_Catalog_Model_Product $product, $data) {
		
		//This array is needed for Magento to specify some details about the image
		$visibility = array (
			'thumbnail',
			'small_image',
			'image'
		);
		
		if($data) {
			
			//Download the image trough curl
			$ch = curl_init();
			curl_setopt ($ch, CURLOPT_URL, $data);
			curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
			curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT, 0);
			$fileContents = curl_exec($ch);
			$content_type = curl_getinfo($ch, CURLINFO_CONTENT_TYPE);
			curl_close($ch);
			
			if($content_type === 'image/jpeg') {
				
				$newImg = imagecreatefromstring($fileContents);
				
				//temporarily save the image with a random name
				$path = $filename = Mage::getBaseDir('tmp') . DS . 'ezimport' . DS . 'temp_img' . DS . md5( time() . rand(1,999)) . '.jpg';
				imagejpeg($newImg, $path, 100);
	
				//actually add the image to the product
				$product->addImageToMediaGallery ($filename, $visibility, true, false);
				
				//delete the temporarily image
				if(is_file($path))
					unlink($path);
			}

		}
</pre>	
	<p>This is the most important method. When a product gets imported, the setData method will 
	be called to set the data in the Magento product. We can do any transformation to the XML 
	value that we want, before it gets saved in the Magento product.</p>
<pre>		
	}
	
}</pre>
				<p><a target=_blank href="https://github.com/TweakIT/Ezimport/blob/master/src/app/code/local/Tweakit/Ezimport/Helper/Attributes/Baseimage.php">Click here to see this file in Github.</a>
				
				<p class="message info">After the setData method, the Magento product gets saved so there is no need to do this in the setData method.</p>

				<p>And thats all there is to it. Adding a file is enough. When mapping a XML, Ezimport will scan the Attributes folder and find your new attribute.</p>
				
				<h2>Step 3 - mapping attributes</h2>
				<p>Coming soon</p>
				<h2>Step 4 - importing your products</h2>
				<p>Coming soon</p>
				<h1>Under the hood</h1>
				
				<p>Coming soon</p>
				
				<h1>Writing tests</h1>
				<p>Coming soon</p>
				<h1>Technical docs</h1>
				<p>Coming soon</p>
				<h1>About</h1>
				<p>Coming soon</p>
			</div>
			
			<div class="grid-16 grid">
				<a href="http://tweakit.eu/" target="_blank" class=logo>
					<img src="img/tweakit.png" alt="TweakIT" title="">
				</a>
			</div>			
			
		</div>

	</article>

</body>
</html>